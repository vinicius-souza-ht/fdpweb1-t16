<!DOCTYPE>
<html>
<head>
<meta charset="UTF-8">
<title>CRUD Usuário</title>


</head>

<body>
	<form action="javascript:void(0)" onsubmit="app.salvar()">

		<input type="text" id="add-nome" placeholder="Novo Usuário"> <input
			type="submit" value="Salvar"> <input type="button"
			value="Cancelar" onclick="app.novo()">

	</form>

	<p id="contador"></p>

	<table border="1">
		<tr></tr>

		<tbody id="usuarios">

		</tbody>
	</table>

</body>

<script>
	var app = new function() {

		this.usuarios = [ 'Jão', 'Maria', 'Zé' ];
		this.itemEditar = -1;

		this.contar = function(qtd) {
			var elContador = document.getElementById("contador");
			var nome = "Usuario";
			if (qtd) {
				if (qtd > 1) {
					nome = "Usuários";
				}
				elContador.innerHTML = qtd + ' ' + nome;

			} else {
				elContador.innerHTML = 'Sem ' + nome;
			}
		};

		this.salvar = function() {

			var elNome = document.getElementById("add-nome");
			var usuario = elNome.value;

			if (usuario) {
				if (this.itemEditar == -1) {

					var xhttp = new XMLHttpRequest();

					//CallBack
					xhttp.onreadystatechange = function() {
						//processou com sucesso
						if (this.readyState == 4 && this.status == 200) {
							//inserindo no vetor
							app.usuarios.push(usuario);
						}
					}

					//Faz o request
					xhttp.open("POST", "usucontroller", true);
					//Formato dos dados para envio
					xhttp.setRequestHeader("Content-type",
							"application/x-www-form-urlencoded");
					xhttp.send("nome=" + usuario);

				} else {

					var xhttp = new XMLHttpRequest();

					//callback
					xhttp.onreadystatechange = function() {
						//processou com sucesso
						if (this.readyState == 4 && this.status == 200) {
							//Altera quando tem alguem para alterar
							this.usuarios.splice(app.itemEditar, 1, usuario
									.trim());
						}
					};
					
					//Faz o request
					xhttp.open("PUT", "usucontroller", true);
					//Formato dos dados para envio
					xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					xhttp.send("i=" + this.itemEditar + "&nome=" + usuario);
					
					this.itemEditar = -1;
				}

			}

			this.listarTodos();
			this.novo();
		}

		this.excluir = function(item) {
			this.usuarios.splice(item, 1);
			this.listarTodos();
		}

		this.editar = function(item) {
			this.itemEditar = item;
			var nome = this.usuarios[item];

			if (nome) {
				document.getElementById("add-nome").value = nome;
			}
		}

		this.listarTodos = function() {
			var dados = '';

			for (var i = 0; i < this.usuarios.length; i++) {
				dados += '<tr>';
				dados += '<td>' + this.usuarios[i] + '</td>';
				dados += '<td><button onclick="app.excluir(' + i
						+ ')">Excluir</button></td>';
				dados += '<td><button onclick="app.editar(' + i
						+ ')">Editar</button></td>';

				dados += '</tr>';
			}

			this.contar(this.usuarios.length);
			document.getElementById("usuarios").innerHTML = dados;
		}

		this.novo = function() {
			this.itemEditar = -1;
			document.getElementById("add-nome").value = "";
		}

	}

	app.listarTodos();
</script>
</html>